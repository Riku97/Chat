<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <h1>Visualizar</h1>
    <button id="btn">Visualizar</button>
    <br>
    <div class="status"></div>
    <canvas id="canvas" style="width: 800px; height: 800px;"></canvas>
    <img id ="play" style="width: 800px; height: 800px;" alt="">
    <audio id="audio" src="" autoplay></audio>
    <br>


    
    <h3>Mensajes:</h3>
    <ul id="listado-msjs">
        
    </ul>
    <div id="env-msjs">
        <input id="nuevo-msj"  placeholder="Nuevo mensaje">
        <button id="btn-msj" onclick="enviarMensaje()">Enviar</button>
    </div>
    
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>

    <!-- Script Chat -->
    <script>
        var socket = io("ws://localhost:3000"); // Inicializamos socketIO en el cliente
     
        /*
        * Evento listener para el 'nuevo mensaje'
        *   Se puede ver que es el mismo evento que se envia 
        *   desde el servidor.
        * Agregamos el mensaje ingresado por el usuario a la lista.
        */
        socket.on('nuevo mensaje', function (msj) {
        $('#listado-msjs').append( $('<li>').text(msj) );
        });
        
        /*
        * Emitimos un evento de tipo 'nuevo mensaje' cada vez
        * que se presiona el bot√≥n enviar y enviamos
        * su contenido como mensaje.
        */
        function enviarMensaje() {
            socket.emit('nuevo mensaje', $('#nuevo-msj').val());
            $('#nuevo-msj').val('');
        };
    </script>




    
    <!-- Script de conexion streaming -->
    <script>
        var btn = document.getElementById("btn");
        var socket = io("ws://localhost:3000");
        var audio = document.getElementById("audio");
        var canvas = document.getElementById("canvas");
        var context = canvas.getContext('2d');

        canvas.width = 512;
        canvas.height = 384;

        context.width = canvas.width;
        context.height = canvas.height;

        btn.addEventListener('click', ()=>{
            console.log("Hola");
            socket.on('stream', (image) =>{
                //let img = document.getElementById("play");
                context.drawImage(video, 0, 0, context.width, context.height);
                //img.src = image;
                audio.src = image;
                console.log("Recibiendo");
            });
        });

        
    </script>
</body>
</html>